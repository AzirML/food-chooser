<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="ä»Šå¤©åƒä»€ä¹ˆï¼Ÿè½»æ¾å†³å®šæ™šé¤">
<title>ä»Šå¤©åƒä»€ä¹ˆï¼Ÿ</title>
<style>
:root {
  --primary: #e67e22;
  --primary-dark: #d35400;
  --bg: #faf7f2;
  --card: #ffffff;
  --text: #333333;
  --text-light: #7f8c8d;
  --success: #27ae60;
  --error: #e74c3c;
  --shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
  --radius: 12px;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
  background: var(--bg);
  color: var(--text);
  line-height: 1.6;
  min-height: 100vh;
  padding: 20px;
}

.container {
  max-width: 600px;
  margin: 0 auto;
}

.header {
  text-align: center;
  margin-bottom: 40px;
  padding-top: 20px;
}

.header h1 {
  color: var(--primary);
  font-size: 2.5rem;
  margin-bottom: 10px;
  background: linear-gradient(135deg, var(--primary), var(--primary-dark));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}

.header p {
  color: var(--text-light);
  font-size: 1.1rem;
}

.menu-container {
  margin-bottom: 40px;
}

.dish-item {
  background: var(--card);
  border-radius: var(--radius);
  padding: 24px;
  margin-bottom: 16px;
  cursor: pointer;
  transition: all 0.3s ease;
  border: 2px solid transparent;
  box-shadow: var(--shadow);
}

.dish-item:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
}

.dish-item.selected {
  background: linear-gradient(135deg, #fff9f0, #ffecc7);
  border-color: var(--primary);
  transform: scale(1.02);
}

.dish-name {
  font-size: 1.4rem;
  font-weight: 700;
  color: #2c3e50;
  margin-bottom: 8px;
}

.dish-desc {
  color: var(--text-light);
  font-size: 1rem;
  line-height: 1.5;
  margin-top: 8px;
}

.actions {
  margin-top: 40px;
}

.primary-btn {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 10px;
  width: 100%;
  padding: 20px;
  background: linear-gradient(135deg, var(--primary), var(--primary-dark));
  color: white;
  border: none;
  border-radius: var(--radius);
  font-size: 1.3rem;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
  box-shadow: 0 4px 20px rgba(230, 126, 34, 0.3);
}

.primary-btn:hover:not(:disabled) {
  transform: translateY(-2px);
  box-shadow: 0 8px 28px rgba(230, 126, 34, 0.4);
}

.primary-btn:disabled {
  background: #bdc3c7;
  cursor: not-allowed;
  transform: none;
  box-shadow: none;
  opacity: 0.7;
}

.secondary-btn {
  display: block;
  width: 100%;
  padding: 16px;
  background: transparent;
  color: var(--primary);
  border: 2px solid var(--primary);
  border-radius: var(--radius);
  font-size: 1.1rem;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
  margin-top: 16px;
}

.secondary-btn:hover {
  background: rgba(230, 126, 34, 0.1);
}

.loading {
  text-align: center;
  padding: 60px 20px;
}

.loading-spinner {
  width: 60px;
  height: 60px;
  border: 4px solid #f3f3f3;
  border-top: 4px solid var(--primary);
  border-radius: 50%;
  animation: spin 1s linear infinite;
  margin: 0 auto 20px;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

.error {
  background: #fdedec;
  border: 2px solid var(--error);
  border-radius: var(--radius);
  padding: 30px;
  text-align: center;
  margin: 20px 0;
}

.success {
  background: #eafaf1;
  border: 2px solid var(--success);
  border-radius: var(--radius);
  padding: 20px;
  text-align: center;
  margin: 20px 0;
}

.empty-state {
  text-align: center;
  padding: 60px 20px;
  color: var(--text-light);
}

.footer {
  text-align: center;
  margin-top: 60px;
  padding-top: 20px;
  border-top: 1px solid #eee;
  color: var(--text-light);
  font-size: 0.9rem;
}

@media (max-width: 480px) {
  .header h1 { font-size: 2rem; }
  .dish-item { padding: 20px; }
  .dish-name { font-size: 1.2rem; }
}
</style>
</head>
<body>
<div class="container">
  <div class="header">
    <h1>ğŸ½ï¸ ä»Šå¤©åƒä»€ä¹ˆï¼Ÿ</h1>
    <p>ç‚¹å‡»èœå“é€‰æ‹©ï¼Œç„¶ååˆ†äº«ç»™ä»–/å¥¹</p>
  </div>

  <div class="menu-container" id="menuContainer">
    <div class="loading">
      <div class="loading-spinner"></div>
      <p>æ­£åœ¨åŠ è½½ç¾å‘³èœå•...</p>
    </div>
  </div>

  <div class="actions">
    <button class="primary-btn" id="shareBtn" disabled>
      ğŸ“¤ é€‰å¥½å•¦ï¼Œåˆ†äº«ç»™ä»–ï¼
    </button>
    
    <button class="secondary-btn" id="randomBtn">
      ğŸ² å¸®æˆ‘éšæœºé€‰ä¸€ä¸ª
    </button>
  </div>

  <div class="footer">
    <p>âœ¨ æ¯å¤©åƒä»€ä¹ˆä¸å†çº ç»“ | æ•°æ®é€šè¿‡å®‰å…¨APIè®¿é—®</p>
  </div>
</div>

<script>
// é…ç½®
const API_URL = '/api/menu';

// çŠ¶æ€
let menuData = [];
let selectedDish = null;

// DOMå…ƒç´ 
const menuContainer = document.getElementById('menuContainer');
const shareBtn = document.getElementById('shareBtn');
const randomBtn = document.getElementById('randomBtn');

// HTMLè½¬ä¹‰
function escapeHTML(text) {
  const div = document.createElement('div');
  div.textContent = text;
  return div.innerHTML;
}

// è·å–èœå•
async function fetchMenu() {
  try {
    const response = await fetch(API_URL);
    if (!response.ok) throw new Error(`HTTPé”™è¯¯: ${response.status}`);
    const data = await response.json();
    menuData = data;
    displayMenu(menuData);
  } catch (error) {
    console.error('è·å–èœå•å¤±è´¥:', error);
    menuContainer.innerHTML = `
      <div class="error">
        <h3>âŒ å‡ºé”™äº†</h3>
        <p>${escapeHTML(error.message)}</p>
        <button class="secondary-btn" onclick="fetchMenu()" style="margin-top: 15px;">
          é‡æ–°åŠ è½½
        </button>
      </div>
    `;
  }
}

// æ˜¾ç¤ºèœå•
function displayMenu(dishes) {
  if (!dishes || dishes.length === 0) {
    menuContainer.innerHTML = `
      <div class="empty-state">
        <h3>èœå•ç©ºç©ºå¦‚ä¹Ÿ</h3>
        <p>å¿«å»æ·»åŠ ä¸€äº›èœå“å§ï¼</p>
      </div>
    `;
    return;
  }
  
  let html = '';
  dishes.forEach((dish, index) => {
    html += `
      <div class="dish-item" data-index="${index}">
        <div class="dish-name">${escapeHTML(dish.name)}</div>
        ${dish.description ? `<div class="dish-desc">${escapeHTML(dish.description)}</div>` : ''}
      </div>
    `;
  });
  
  menuContainer.innerHTML = html;
  
  // æ·»åŠ ç‚¹å‡»äº‹ä»¶
  document.querySelectorAll('.dish-item').forEach(item => {
    item.addEventListener('click', (event) => {
      document.querySelectorAll('.dish-item').forEach(i => i.classList.remove('selected'));
      event.currentTarget.classList.add('selected');
      const index = parseInt(event.currentTarget.dataset.index);
      selectedDish = menuData[index];
      shareBtn.disabled = false;
    });
  });
}

// éšæœºé€‰æ‹©
randomBtn.addEventListener('click', () => {
  if (menuData.length === 0) return;
  const randomIndex = Math.floor(Math.random() * menuData.length);
  document.querySelectorAll('.dish-item').forEach(i => i.classList.remove('selected'));
  selectedDish = menuData[randomIndex];
  const dishElement = document.querySelector(`.dish-item[data-index="${randomIndex}"]`);
  if (dishElement) {
    dishElement.classList.add('selected');
    dishElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
  }
  shareBtn.disabled = false;
});

// åˆ†äº«åŠŸèƒ½
shareBtn.addEventListener('click', () => {
  if (!selectedDish) return;
  const shareText = `ä»Šå¤©æˆ‘æƒ³åƒï¼š${selectedDish.name}ï¼${selectedDish.description ? ` (${selectedDish.description})` : ''}`;
  
  if (navigator.share) {
    navigator.share({
      title: 'ä»Šå¤©åƒä»€ä¹ˆ',
      text: shareText
    });
  } else {
    navigator.clipboard.writeText(shareText).then(() => {
      alert('âœ… å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼\n\nå¿«æ‰“å¼€å¾®ä¿¡å‘é€ç»™ä»–å§ï¼');
    }).catch(() => {
      prompt('è¯·å¤åˆ¶ä¸‹é¢çš„æ–‡å­—ï¼š', shareText);
    });
  }
});

// åˆå§‹åŒ–
document.addEventListener('DOMContentLoaded', fetchMenu);
</script>
</body>
</html>